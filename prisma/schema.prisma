generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // Uses connection pooling
  url = env("POSTGRES_PRISMA_URL")
  // Uses direct connection, ⚠️ make sure to keep this to `POSTGRES_URL_NON_POOLING`
  // or you'll have dangling databases from migrations
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Movie {
  id             String   @id @default(uuid())
  title          String
  description    String
  year           Int
  duration       Int
  genres         String[]
  directors      String[]
  rating         Float
  votes          Int
  imageUrl       String   @map("image_url")
  trailerUrl     String   @map("trailer_url")
  showtimes      Showtime[]
  reviews        Review[]
}

model Showtime {
  id               String   @id @default(uuid())
  movie            Movie    @relation(fields: [movieId], references: [id])
  movieId          String   @map("movie_id")
  date             DateTime
  time             String
  availableSeats   Json     @map("available_seats")
}

model User {
  id          String   @id @default(uuid())
  email       String   @unique
  name        String
  imageUrl    String   @map("image_url")
  reviews     Review[]
}

model Review {
  id            String   @id @default(uuid())
  user          User     @relation(fields: [userId], references: [id])
  userId        String   @map("user_id")
  movie         Movie    @relation(fields: [movieId], references: [id])
  movieId       String   @map("movie_id")
  rating        Int
  comment       String?
  createdAt     DateTime @default(now()) @map("created_at")

  @@index([userId], name: "idx_user_id")
  @@index([movieId], name: "idx_movie_id")
}